'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var http = require('http');
var url = require('url');
var nodeHTTPRequestHandler = require('../../../dist/nodeHTTPRequestHandler-8ddacc19.cjs.prod.js');
require('../../../dist/resolveHTTPResponse-562c3d62.cjs.prod.js');
require('../../../dist/transformTRPCResponse-dcbf66c5.cjs.prod.js');
require('../../../dist/codes-e0df67c4.cjs.prod.js');

function _interopDefault (e) { return e && e.__esModule ? e : { 'default': e }; }

var http__default = /*#__PURE__*/_interopDefault(http);
var url__default = /*#__PURE__*/_interopDefault(url);

/* eslint-disable @typescript-eslint/no-non-null-assertion */
function createHTTPHandler(opts) {
  return async (req, res) => {
    const endpoint = url__default['default'].parse(req.url).pathname.slice(1);
    await nodeHTTPRequestHandler.nodeHTTPRequestHandler({ ...opts,
      req,
      res,
      path: endpoint
    });
  };
}
function createHTTPServer(opts) {
  const handler = createHTTPHandler(opts);
  const server = http__default['default'].createServer((req, res) => handler(req, res));
  return {
    server,

    listen(port) {
      server.listen(port);
      const actualPort = port === 0 ? server.address().port : port;
      return {
        port: actualPort
      };
    }

  };
}

exports.createHTTPHandler = createHTTPHandler;
exports.createHTTPServer = createHTTPServer;
